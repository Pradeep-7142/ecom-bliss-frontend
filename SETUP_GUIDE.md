# üîê Authentication System Setup Guide

This guide will help you set up the complete authentication system for your Ecom Bliss application.

## üöÄ Quick Start

### 1. Backend Setup

```bash
cd backend

# Install dependencies
npm install

# Run setup script (creates .env file with generated secrets)
npm run setup

# Start MongoDB (if not running as service)
mongod

# Start the development server
npm run dev
```

### 2. Frontend Setup

```bash
cd ecom-bliss-frontend

# Install dependencies
npm install

# Create environment file
cp env.example .env

# Start the development server (runs on port 8080)
npm run dev
```

## üìã Environment Configuration

### Backend Environment (.env)

The setup script will create this automatically, but here's what you need:

```env
# Database
MONGO_URI=mongodb://localhost:27017/ecom-bliss

# JWT Secret (auto-generated by setup script)
JWT_SECRET=your-generated-jwt-secret

# Server Configuration
PORT=5000
NODE_ENV=development

# Frontend URL
FRONTEND_URL=http://localhost:8080

# Backend URL
BACKEND_URL=http://localhost:5000

# Session Secret (auto-generated by setup script)
SESSION_SECRET=your-generated-session-secret

# Google OAuth (Optional)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### Frontend Environment (.env)

```env
# API Configuration
VITE_API_URL=http://localhost:5000/api

# App Configuration
VITE_APP_NAME=Ecom Bliss
VITE_APP_VERSION=1.0.0
```

## üåê Google OAuth Setup (Optional)

To enable Google OAuth login:

### Step 1: Google Cloud Console Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select an existing one
3. Enable the Google+ API:
   - Go to "APIs & Services" ‚Üí "Library"
   - Search for "Google+ API" and enable it
4. Create OAuth 2.0 credentials:
   - Go to "APIs & Services" ‚Üí "Credentials"
   - Click "Create Credentials" ‚Üí "OAuth 2.0 Client IDs"
   - Choose "Web application"
   - Add authorized redirect URIs:
     - `http://localhost:5000/api/auth/google/callback` (development)
     - `https://yourdomain.com/api/auth/google/callback` (production)
5. Copy the Client ID and Client Secret

### Step 2: Update Environment Variables

Add the Google credentials to your backend `.env` file:

```env
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### Step 3: Test Google OAuth

1. Restart your backend server
2. Go to your frontend application
3. Click "Continue with Google" in the login dialog
4. Complete the Google authentication flow

## üîß Testing the Authentication System

### Manual Registration/Login

1. **Register a new user:**
   ```bash
   curl -X POST http://localhost:5000/api/auth/register \
     -H "Content-Type: application/json" \
     -d '{
       "name": "Test User",
       "email": "test@example.com",
       "password": "password123",
       "phone": "+1234567890"
     }'
   ```

2. **Login with the user:**
   ```bash
   curl -X POST http://localhost:5000/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{
       "email": "test@example.com",
       "password": "password123"
     }'
   ```

3. **Get user profile (with token):**
   ```bash
   curl -X GET http://localhost:5000/api/auth/profile \
     -H "Authorization: Bearer YOUR_JWT_TOKEN"
   ```

### Frontend Testing

1. Open your frontend application
2. Click the login/signup button
3. Try both manual registration and Google OAuth
4. Test the authentication flow

## üõ†Ô∏è Troubleshooting

### Common Issues

#### 1. MongoDB Connection Error
```
Error: connect ECONNREFUSED 127.0.0.1:27017
```
**Solution:**
- Ensure MongoDB is running: `mongod`
- Check your connection string in `.env`
- For MongoDB Atlas, use the full connection string

#### 2. JWT Secret Error
```
Error: jwt.sign() requires a secret or private key
```
**Solution:**
- Run `npm run setup` to generate secrets
- Or manually set `JWT_SECRET` in `.env`

#### 3. Google OAuth Error
```
Error: Invalid client
```
**Solution:**
- Verify Google Cloud Console setup
- Check Client ID and Secret are correct
- Ensure redirect URIs match exactly
- Make sure Google+ API is enabled

#### 4. CORS Error
```
Access to fetch at 'http://localhost:5000/api/auth/login' from origin 'http://localhost:8080' has been blocked by CORS policy
```
**Solution:**
- Check `FRONTEND_URL` in backend `.env`
- Ensure frontend is running on port 8080
- Restart the backend server

#### 5. Frontend API Connection Error
```
Failed to fetch
```
**Solution:**
- Check `VITE_API_URL` in frontend `.env`
- Ensure backend is running on the correct port
- Check network connectivity

### Debug Mode

Enable detailed logging:

```bash
# Backend
DEBUG=* npm run dev

# Frontend
npm run dev
```

## üîí Security Features

### Implemented Security Measures

1. **Password Security:**
   - Bcrypt hashing with salt rounds
   - Minimum password length validation
   - Password strength requirements

2. **JWT Authentication:**
   - Secure token generation
   - Token expiration (7 days)
   - Automatic token validation

3. **Input Validation:**
   - Email format validation
   - Required field validation
   - Data sanitization

4. **Error Handling:**
   - Consistent error responses
   - No sensitive data in error messages
   - Proper HTTP status codes

5. **CORS Protection:**
   - Configured for specific origins
   - Credentials support
   - Secure cookie settings

## üìä API Endpoints Reference

### Authentication Endpoints

| Method | Endpoint | Description | Auth Required |
|--------|----------|-------------|---------------|
| POST | `/api/auth/register` | Register new user | No |
| POST | `/api/auth/login` | Login user | No |
| POST | `/api/auth/logout` | Logout user | Yes |
| GET | `/api/auth/google` | Google OAuth login | No |
| GET | `/api/auth/google/callback` | Google OAuth callback | No |
| GET | `/api/auth/profile` | Get user profile | Yes |
| PUT | `/api/auth/profile` | Update user profile | Yes |
| PUT | `/api/auth/change-password` | Change password | Yes |
| POST | `/api/auth/forgot-password` | Request password reset | No |
| POST | `/api/auth/reset-password` | Reset password | No |

### Request/Response Examples

#### Register User
```bash
POST /api/auth/register
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123",
  "phone": "+1234567890"
}
```

**Response:**
```json
{
  "message": "User registered successfully",
  "user": {
    "_id": "60f7b3b3b3b3b3b3b3b3b3b3",
    "name": "John Doe",
    "email": "john@example.com",
    "role": "customer",
    "isEmailVerified": false,
    "isActive": true
  },
  "token": "eyJhbGciOiJIUzI1NiIs..."
}
```

#### Login User
```bash
POST /api/auth/login
Content-Type: application/json

{
  "email": "john@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "message": "Login successful",
  "user": {
    "_id": "60f7b3b3b3b3b3b3b3b3b3b3",
    "name": "John Doe",
    "email": "john@example.com",
    "role": "customer",
    "isEmailVerified": false,
    "isActive": true
  },
  "token": "eyJhbGciOiJIUzI1NiIs..."
}
```

## üöÄ Production Deployment

### Environment Variables for Production

```env
# Database
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/ecom-bliss

# Security
JWT_SECRET=your-super-strong-production-secret
SESSION_SECRET=your-super-strong-session-secret

# URLs
FRONTEND_URL=https://yourdomain.com
BACKEND_URL=https://api.yourdomain.com

# Google OAuth
GOOGLE_CLIENT_ID=your-production-google-client-id
GOOGLE_CLIENT_SECRET=your-production-google-client-secret

# Server
NODE_ENV=production
PORT=5000
```

### Security Checklist

- [ ] Use strong, unique secrets for JWT and sessions
- [ ] Enable HTTPS in production
- [ ] Configure proper CORS origins
- [ ] Set up rate limiting
- [ ] Implement logging and monitoring
- [ ] Use environment variables for all secrets
- [ ] Regular security updates
- [ ] Database backup strategy

## üìû Support

If you encounter any issues:

1. Check the troubleshooting section above
2. Verify all environment variables are set correctly
3. Check the console logs for detailed error messages
4. Ensure MongoDB is running and accessible
5. Test the API endpoints directly with curl or Postman

## üéâ Success!

Once everything is set up correctly, you should have:

- ‚úÖ User registration and login
- ‚úÖ Google OAuth integration
- ‚úÖ JWT token authentication
- ‚úÖ User profile management
- ‚úÖ Password reset functionality
- ‚úÖ Secure password hashing
- ‚úÖ Input validation and error handling
- ‚úÖ CORS protection
- ‚úÖ Role-based access control

Your authentication system is now ready for production use! üöÄ 